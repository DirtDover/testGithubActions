# TA Brief: Web Application Penetration Test for IBC

Welcome to the advanced web pentest afternoon session! This brief provides you, the Teaching Assistant (TA), with clear instructions on how to guide students as they analyze the IBC web application, identify security vulnerabilities, and propose remediation strategies.

## Overview and Objectives

Module: Advanced Web Penetration Testing  
Focus: Identifying and Exploiting Common Web Vulnerabilities in the IBC Application

### Learning Objectives

- Vulnerability Recognition:  
  Help students identify a broad range of web security flaws (e.g., Broken Access Control, SQL Injection, XSS, XXE, SSRF).
- Impact Assessment:  
  Encourage students to analyze why each vulnerability matters, relating it to real-world consequences, such as unauthorized access, data exposure, or system compromise.
- Remediation and Best Practices:  
  Guide students in recommending practical and industry-standard fixes for identified vulnerabilities (e.g., implementing proper authentication, sanitizing inputs, using parameterized queries, enabling secure encryption).

## Daily Schedule

- 13:30 - 13:45: Introduction to Web Pentest Exercise

  - Briefly recap the IBC scenario and the importance of secure web applications.
  - Emphasize the OWASP Top Ten.

- 13:45 - 16:00: Vulnerability Discovery & Analysis
  - Students explore the web application endpoints using their chosen tools (browser, Burp Suite, etc.).
  - They should look for issues such as missing access controls, weak encryption, injection points, and sensitive data exposure.
- 16:00 - 16:10: Break

- 16:10 - 17:30: Documenting Findings & Proposing Solutions
  - Students consolidate discovered vulnerabilities into a structured report.
  - They detail the root cause, impact, and recommended remediation for each issue.
- 17:30 - 17:45: Q&A, Group Discussion, and Feedback

  - Encourage students to share findings, compare approaches, and discuss proposed solutions.
  - Highlight real-world examples and industry practices for prevention and mitigation.

- 17:45 - 18:00: Daily Recap and Closing
  - Summarize the day's activities.
  - Provide an overview of tomorrow's schedule and objectives.
  - Remind student to look at the next day's courses.

## TA Responsibilities

### During Vulnerability Discovery

1. Prompt Students to Consider the Entire OWASP Top Ten:

   - If they focus only on injection, remind them to consider Broken Access Control, Cryptographic Failures, Insecure Design, and others.
   - Encourage them to test endpoints for both authenticated and unauthenticated scenarios.

2. Suggest Systematic Approaches:

   - Recommend they check for missing authentication by removing session cookies and re-accessing endpoints.
   - Guide them to try various input manipulations: single quotes for SQLi, XML payloads for XXE, directory traversal patterns for Path Traversal, etc.

3. Encourage Realistic Attack Scenarios:
   - Ask them to consider how an attacker might chain vulnerabilities, e.g., use an SSRF to access internal services or leverage a weak encryption scheme after gaining partial access.

### During Documentation and Remediation Phase

- Clarify Technical Concepts:  
  If a student is unclear why plaintext passwords are a problem, explain data breaches and credential reuse attacks. For SSRF, explain how attackers might pivot into internal networks.

- Promote Best Practices:  
  Encourage students to recommend concrete solutions, such as:

  - Using parameterized queries for SQL injection prevention.
  - Implementing proper authorization checks before granting access to sensitive endpoints.
  - Hashing and salting passwords with strong algorithms like Argon2.
  - Validating and sanitizing all user inputs.
  - Configuring secure error pages to prevent information leakage.

- Review Reports for Clarity and Completeness:  
  Ensure each documented vulnerability is described with evidence (e.g., screenshots, request/response samples), explains the potential impact on IBC’s security, and includes actionable remediation advice.

### General Support

- Monitor Progress:  
  Identify students struggling with tool usage or conceptual understanding. Offer guidance without providing direct answers—encourage them to reason through the problem.

- Foster Collaboration:  
  Suggest students compare findings with peers. If one group finds an XSS vector, let them discuss with others who missed it.

- Answer Questions Precisely:  
  Provide context, OWASP references, or CWE entries if they need authoritative references. Avoid overwhelming them with too much jargon—keep explanations accessible.

## Common Issues and Solutions

- Students Not Finding Advanced Flaws (e.g., SSRF, XXE):  
  Prompt them with hints like, “Have you tried referencing internal resources with the user-uploaded URL?” or “What happens if you modify XML files to reference external entities?”

- Difficulty Understanding Impact:  
  Ask them to consider how an attacker could escalate a simple flaw into a significant breach. For example, a missing authorization check might allow fund transfers or sensitive data extraction.

- Vague Recommendations:  
  If their solutions are too general, prompt them: “Instead of just saying ‘encrypt passwords,’ can you name a recommended hashing function and detail where it should be applied?”

## Additional Tips

- Highlight Professional Relevance:  
  Remind students these are common real-world vulnerabilities. Being able to identify and fix them is crucial in a professional pentesting role.

- Time Management:  
  Gently nudge students to keep pace. If they get stuck on one vulnerability, recommend moving on and coming back later.

- Encourage Curiosity:  
  Praise students for exploring endpoints creatively or testing different attack vectors. Positive reinforcement helps build confidence.

By following this brief, you’ll help students gain hands-on experience in advanced web pentesting techniques, enabling them to think critically about application security and apply secure coding and defensive design principles in their future work.

---

# Solution: Web Application Penetration Test for IBC

## 1. Broken Access Control

### CWE-285 Improper Authorization

**Issue:** The REST API does not authorize the user, allowing unauthorized access.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_1.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** Access the following endpoints directly:

- `/Transaction/Edit`
- `/Transaction/Delete`
- `/Transaction/DeleteConfirmed`

These endpoints can be accessed without proper authorization.

### Missing Authentication

**Issue:** Endpoints that should be protected are accessible without authentication.

**Solution:**

1. Delete the `SessionId` cookie.
2. Access the following endpoints:
   - `/api/User/GetAvaliableFunds?user={username}`
   - `/api/User/ProfileImage?user={username}`

These endpoints can be accessed without authentication.

### Unconfirmed Login

**Issue:** Accessing `/Transaction` with an unconfirmed account.

**Solution:**

1. Register a new user.
2. Navigate to `/Transaction` without confirming the account.

The page source will reveal sensitive information.

## 2. Cryptographic Failures

### CWE-261 Weak Encoding for Password

**Issue:** Passwords are stored in plaintext, making them vulnerable in case of a database breach.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_2.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_3.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** Implement proper password hashing using strong algorithms like bcrypt, Scrypt, or Argon2.

### Get Another User's Available Funds

**Issue:** The endpoint reveals other users' account balances.

**Solution:** Modify the request to `/User/GetAvailbleFunds?user={username}` with different usernames to access their balances.

### Get Another User's Profile Image

**Issue:** The endpoint reveals other users' profile images.

**Solution:** Modify the request to `/User/ProfileImage?user={username}` with different usernames to access their profile images.

### Enumeration of Transactions

**Issue:** Transactions can be enumerated and viewed without proper authorization.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_4.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_5.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:**

1. Navigate to `/Transaction/Details/{transaction_id}`.
2. Change the `transaction_id` to access other users' transactions.

### Path Traversal

**Issue:** The application is vulnerable to path traversal attacks.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_6.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:**

1. Access `/api/User/ProfileImage?user=../appsettings.json` or `/api/User/ProfileImage?user=../../appsettings.json` to retrieve sensitive files.

## 3. Injection

### SQL Injection (SQLi)

**Issue:** The application is vulnerable to SQL injection.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_7.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_8.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_9.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:**

1. Navigate to `/Transaction/Index`.
2. In the search field, input a single quote `'` to test for SQL injection.
3. Craft appropriate SQL injection payloads to retrieve all transactions from the database.

## 4. Insecure Design

### CWE-257: Storing Passwords in a Recoverable Format

**Issue:** Passwords are stored in plaintext.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_10.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** Implement proper password hashing using strong algorithms like bcrypt, Scrypt, or Argon2.

## 5. Security Misconfiguration

### Missing Custom Error Page

**Issue:** The application exposes detailed error information.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_11.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** Upload an invalid XML file on the `/Transaction` page to trigger an exception and view the exposed information.

### Hidden Administrative Page

**Issue:** A development page used during the application's development phase is still accessible.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_12.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** By examining the source code of `api/Auth/Register`, you can find a commented-out JavaScript method that references an administrative registration page. Accessing `/Auth/RegisterAdmin` reveals this hidden page. `:contentReference[oaicite:1]{index=1}`

### Registration with Admin Role

**Issue:** It's possible to register a new user with administrative privileges without proper authorization.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_13.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_14.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** By intercepting the registration request to `Auth/Register` and modifying the `userRight` parameter to a value greater than 50, you can create a user with administrative rights. For example, setting `userRight` to 100 in the registration payload grants admin privileges. `:contentReference[oaicite:2]{index=2}`

## 6. Vulnerable and Outdated Components

**Issue:** The application uses outdated components with known vulnerabilities.

**Solution:** Update all components, libraries, and frameworks to their latest secure versions.

## 7. Identification and Authentication Failures

### CWE-287: Improper Authentication / CWE-521: Weak Password Requirements

**Issue:** The application allows weak passwords and stores them in plaintext.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_15.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_16.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_17.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_18.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />
<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_19.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:**

1. Bypass client-side validation to register a user with a weak password.
2. Inspect the code to find that passwords are stored in plaintext.

## 8. Software and Data Integrity Failures

### CWE-502 Deserialization of Untrusted Data

**Issue:** User cookies are not signed, allowing manipulation.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_20.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** Modify the user's cookie to elevate permissions to the administrator level by changing the last number to 50 or more.

## 9. Security Logging and Monitoring Failures

**Issue:** The application lacks proper logging and monitoring.

**Solution:** Implement comprehensive logging and monitoring to detect and respond to security incidents promptly.

## 10. Server-Side Request Forgery (SSRF)

**Issue:** The application allows users to upload arbitrary profile pictures without validating the URL.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_21.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:** Upload a profile picture from an internal URL to perform SSRF attacks.

## 11. Cross-Site Scripting (XSS)

**Issue:** The application is vulnerable to persistent XSS attacks.

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_22.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Solution:**

1. Create a new transaction with `<iframe src="javascript:alert(1)">` set for `Reason` or `Reference`.
2. Search for `<iframe src="javascript:alert(1)">` on the `/PortalSearch` page.

## 12. XML External Entities (XXE)

<img src='https://cyber-lead-assets.s3.amazonaws.com/M03-Security_Evaluation_and_Testing_Red/D03-Web_Pentesting_01/03-solutions/img_23.png' style={{ width: '100%', maxWidth: '500px', margin: '0 auto' }} />

**Issue:** The application is vulnerable to XXE attacks.

**Solution:**

1. Upload an XML file with the following content:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo
  [
      <!ELEMENT foo ANY >
      <!ENTITY xxe SYSTEM "file:///C:/Windows/System32/drivers/etc/hosts" >
]>
<foo>&xxe;</foo>
```

or

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo
  [
      <!ELEMENT foo ANY >
      <!ENTITY xxe SYSTEM "file:///etc/passwd" >
]>
<foo>&xxe;</foo>
```

more details on : https://ssrd.gitbook.io/securebank
