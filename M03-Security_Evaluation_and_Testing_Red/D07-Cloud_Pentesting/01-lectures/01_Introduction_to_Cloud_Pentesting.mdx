# Introduction to Cloud Pentesting

## What you will learn in this course üßêüßê

- Understand cloud implications for companies
- Discover major cloud providers and their services
- Dive into legal and regulatory frameworks for cloud pentesting

## Definition and Importance

### What is Cloud Pentesting?

In today's digital age, cloud security is crucial for businesses. With ninety percent of companies relying on the cloud, and more migrating their infrastructure and applications to it every day, the complexity of securing cloud environments has increased significantly.

This complexity arises from the numerous services offered by cloud providers, each with unique configurations and security requirements. Additionally, the lack of sufficient training for personnel in cloud security practices leads to more frequent errors and misconfigurations, which can be exploited.

### Why is Cloud Pentesting Important Now?

According to the [2023 Pen Testing Report](https://www.coresecurity.com/resources/guides/2023-pen-testing-survey-report), cloud environments are often overlooked compared to other infrastructures. In the graph below, you can see that only 47% of pentests are carried out on a cloud infrastructure, according to this report.

![Compare_Pentest_Infra](https://cyber-lead-assets.s3.amazonaws.com/M01-Security_Evaluation_and_Testing_(Red)/D08-Cloud_Pentesting/01-lectures/Compare_Pentest_Infra.png)

However, a report by Thales shows a 26% to 40% increase in personal data stored in the cloud, with only 45% of that data being encrypted.

Understanding why cloud pentesting is more difficult to set up:

1. **Increased Complexity**: Cloud environments are often more complex than traditional infrastructures, creating new potential attack surfaces.
2. **Shared Responsibility**: The shared security model between cloud providers and clients requires a thorough understanding of each party's responsibilities.
3. **Rapid Evolution**: Cloud services constantly evolve, introducing new features and potential vulnerabilities.
4. **Regulatory Compliance**: Many regulations require regular security testing, including for cloud environments.

## Differences from Traditional Pentesting

### Cloud-Specific Environments

The primary difference between traditional and cloud pentesting lies in the environment and approach. In the cloud, rather than performing a typical penetration test, the focus is often on configuration review. This involves assessing cloud services provided by vendors like AWS and GCP to ensure they are securely configured according to best practices. These providers have strict guidelines on how security assessments should be conducted, emphasizing compliance and configuration checks rather than direct attack simulations. By focusing on configuration reviews and combining the security efforts of cloud providers with your own security assessments, you achieve a more comprehensive security posture. In traditional (on-premises) environments, you are solely responsible for all aspects of security, including both configuration and active defense measures.

### New Attack Vectors

The **cloud network** introduces a range of attack vectors that can compromise security. Remote accessibility of **servers** in the cloud, coupled with publicly exposed resources, often lacks adequate security measures, making them vulnerable to attacks such as **brute force**, **denial of service (DoS)**, and **phishing**. These attacks can lead to unauthorized access, system downtime, and potential data breaches.

**Identity Access Management (IAM)** is a critical vector in cloud security, where misconfigurations like overly permissive access or the use of wildcard permissions can unintentionally expose sensitive data. Issues such as **cross-account access** further exacerbate the risk; a breach in one account can cascade into others, compromising multiple layers of an organization's infrastructure.

**Data exfiltration** is another key attack vector, especially as more enterprises store sensitive information in the cloud. Attackers may exploit weak access controls or insufficient monitoring to steal data, making it vital to implement rigorous data protection measures and continuous monitoring for anomalies.

**Cloud security misconfigurations** represent a significant attack vector, often resulting from human error, default settings, or complex system setups. These misconfigurations can leave critical systems and data exposed, providing attackers with easy entry points.

Additionally, vulnerabilities in cloud systems can arise from using outdated or unpatched software. Attackers often target these weaknesses with **malware** or **viruses**, underscoring the importance of consistent updates and a robust patch management strategy.

## Cloud Service Models

### What is IaaS (Infrastructure-as-a-Service)?

**Infrastructure-as-a-Service (IaaS)** provides all the elements of a computing infrastructure, such as network features, virtual machines, and data storage, as services. This virtualized infrastructure is offered and maintained by the cloud provider.

IaaS allows developers to use their usual environment without installing and configuring new servers. It offers flexibility to scale resources as needed, making it ideal for early cloud adoption to refine the company's cloud needs. Microsoft Azure is a well-known IaaS provider, offering compute, storage, and networking resources on a pay-as-you-go basis.

**Example:** A company uses **AWS EC2** to host virtual servers for their web application. AWS EC2 (Elastic Compute Cloud) provides scalable computing capacity in the cloud, allowing users to run applications on virtual servers, known as instances. With EC2, businesses can launch as many or as few virtual servers as they need, scaling up or down based on user traffic, which helps manage costs and resources effectively.

### What is PaaS (Platform-as-a-Service)?

**Platform-as-a-Service (PaaS)** includes all software resources needed to develop cloud-native applications. Developers benefit from a complete development and testing platform without managing the underlying infrastructure. This includes the operating system, security measures, database management systems, application servers, and development frameworks.

Google App Engine (GAE) is a notable PaaS, allowing developers to create and deploy applications using popular programming languages without managing infrastructure.

**Example:** Developers use **Microsoft Azure App Service** to build and deploy web apps. Azure App Service is a PaaS offering that provides a fully managed platform for developing, deploying, and scaling web applications. Developers can focus on building their apps without worrying about the underlying infrastructure.

### What is SaaS (Software-as-a-Service)?

**Software-as-a-Service (SaaS)** offers ready-to-use software managed by a cloud provider. Users access the application online through a web browser, eliminating the need for administration, maintenance, or updates. Businesses pay a monthly or annual subscription instead of a perpetual license.

Popular SaaS solutions include Microsoft 365 and Google Workspace. SaaS applications cover all business needs, from CRM and ERP to HR information systems and business intelligence tools.

**Example:** An organization subscribes to Microsoft 365 for office productivity tools, accessing applications like Word and Excel directly through the cloud. This allows employees to collaborate and work efficiently from anywhere with internet access, without the need for managing software installations or updates.

### Security Responsibility Sharing

Different models require different security responsibilities based on the part of the infrastructure the company hosts or administers. Here is a comparative table of the different models

![IAASvsPAASvsSAAS](https://cyber-lead-assets.s3.amazonaws.com/M01-Security_Evaluation_and_Testing_(Red)/D08-Cloud_Pentesting/01-lectures/IAASvsPAASvsSAAS.png)

SaaS offers fully outsourced hosting, ideal for small businesses to secure their infrastructure but requires a real trust in the service provider.

## Major Cloud Providers

There are many cloud service providers, but Amazon Web Services (AWS), Microsoft Azure, and Google Cloud Platform (GCP) are the top three cloud providers, controlling 62% of the market as of 2024.

### 1. Amazon Web Services (AWS)

AWS, the cloud service of Amazon.com, is the largest cloud provider globally, offering over 200 fully featured services, including compute, storage, and database.

AWS has 33 regions and 105 availability zones worldwide.

![AWS_LOCATION](AWS_Locations.jpg)

### 2. Microsoft Azure

Microsoft Azure is the second largest cloud provider globally, offering a consistent hybrid cloud experience, developer productivity, AI capabilities, and security & compliance.

Azure has 64 regions and 126 availability zones worldwide.

![Azure_Locations](https://cyber-lead-assets.s3.amazonaws.com/M01-Security_Evaluation_and_Testing_(Red)/D08-Cloud_Pentesting/01-lectures/Azure_Locations.jpg)

### 3. Google Cloud Platform (GCP)

GCP is the third largest cloud provider globally, enabling developers to build, test, and deploy applications on its scalable infrastructure with strong security, data management, and AI capabilities.

GCP has 40 regions and 121 availability zones worldwide.

![Google_Locations](https://cyber-lead-assets.s3.amazonaws.com/M01-Security_Evaluation_and_Testing_(Red)/D08-Cloud_Pentesting/01-lectures/Google_Locations.jpg)

Other cloud providers also offer various services to meet your needs:

| **#** | **Cloud Service Provider**  | **Regions** | **Availability Zones** |
| :---: | :-------------------------: | :---------: | :--------------------: |
|   1   |  Amazon Web Services (AWS)  |     33      |          105           |
|   2   |       Microsoft Azure       |     64      |          126           |
|   3   | Google Cloud Platform (GCP) |     40      |          121           |
|   4   |        Alibaba Cloud        |     30      |           89           |
|   5   |        Oracle Cloud         |     48      |           58           |
|   6   |          IBM Cloud          |     10      |           30           |
|   7   |        Tencent Cloud        |     21      |           65           |
|   8   |          OVHcloud           |     17      |           37           |
|   9   |        DigitalOcean         |      9      |           15           |
|  10   |       Linode (Akamai)       |     20      |           20           |

## Legal and Regulatory Frameworks

### Cloud Provider Authorization and General Terms

#### Importance of Authorization

Obtaining authorization from the cloud service provider (CSP) before conducting any pentest in a cloud environment is crucial. Testing without permission can be perceived as malicious activity, potentially leading to legal action.

#### Authorization Procedure

First, identify the owners of the assets you intend to test, including accounts, services, and infrastructure. Next, communicate with the Cloud Service Provider (CSP) through the appropriate channels, typically found on the CSP's website, to request testing authorization if needed. When making this request, provide specific details about the scope, methods, and testing periods. It's essential to adhere to the general terms and policies regarding security testing outlined by each CSP. Notably, AWS, Azure, and Google Cloud allow some penetration tests without prior authorization, but there are specific limitations.

Each CSP has specific terms for testing. **AWS** allows penetration testing on most of its services without prior authorization but prohibits DoS/DDoS testing and testing on AWS infrastructure itself. For **Microsoft Azure** and **Google Cloud Plateform (GCP)**, they allows penetration testing without prior approval as long as it is limited to customer resources, but it explicitly forbids DoS/DDoS testing.

For cloud services in China, each CSP has specific requirements as well. **Alibaba Cloud**, **Tencent Cloud**, and **Huawei Cloud** may have different policies and restrictions, including prohibiting DoS testing and requiring authorization for certain types of tests. It is crucial to check each CSP's guidelines and obtain the necessary permissions before proceeding with any security testing activities.

### Specific Cloud Standards and Compliance

#### International Standards

**ISO/IEC 27017** offers guidelines for information security controls applied to cloud services, complementing **ISO/IEC 27002**. Meanwhile, **ISO/IEC 27018** focuses on protecting personal data in the cloud, emphasizing Personally Identifiable Information (PII).

#### Regulatory Compliance Frameworks

For regulatory compliance, several frameworks are significant. The **GDPR** (General Data Protection Regulation) is an EU regulation on personal data protection, requiring tests to ensure compliance with requirements like data minimization and pseudonymization. The **HIPAA** (Health Insurance Portability and Accountability Act) in the U.S. mandates that cloud pentests involving healthcare data comply with its security standards. **PCI DSS** (Payment Card Industry Data Security Standard) requires testing cloud environments handling cardholder data to ensure compliance with payment security standards.

#### Compliance Frameworks in China

In China, compliance with specific national standards are a little bit different. **China's Cybersecurity Law** mandates that companies storing or processing Chinese citizens' personal data do so in compliance with local regulations, which include security assessments and data localization requirements. **MLPS 2.0** (Multi-Level Protection Scheme) is a mandatory framework that classifies and sets cybersecurity requirements for different levels of information systems. Additionally, the **PIPL** (Personal Information Protection Law) outlines stringent requirements for personal data protection, similar to GDPR, including consent requirements and cross-border data transfer restrictions. These regulations emphasize the need for rigorous security controls and compliance checks when using cloud services in China.

## Best Practices for Cloud Pentesting

When performing cloud penetration testing, it is crucial to follow legal best practices to ensure ethical and lawful activities. First and foremost, **obtaining explicit authorization** is essential. This authorization should be in writing and clearly outline the scope, objectives, and limitations of the testing. By doing so, all parties involved, including the cloud service provider and clients, are aware of and agree to the planned activities.

Additionally, it is important to **respect the terms of service** of the cloud provider. Ensuring that your tests comply with their policies helps avoid misunderstandings or potential corrective actions. Informing the cloud provider about the tests in advance can also help maintain a good relationship and prevent any disruptions.

Confidentiality of data is another critical aspect. **Protecting sensitive and personal data** during and after the tests is mandatory. Signing non-disclosure agreements (NDAs) can help safeguard client and user information, ensuring that all parties are legally bound to maintain confidentiality.

Documentation plays a significant role in legal compliance. **Keeping detailed logs** of all activities during the test and providing clear, precise reports on the findings is essential. These reports should highlight any discovered vulnerabilities and offer recommendations for remediation.

**Compliance with local and international regulations**, such as **GDPR** or **HIPAA**, is also necessary. Ensuring that the penetration test adheres to these regulations helps protect the privacy and security of data. Moreover, it is vital to avoid violating cybercrime laws during the testing process.

**Managing incidents effectively** is crucial as well. Having a response plan in place to handle any unexpected situations or detected threats during the test can prevent escalation. **Prompt communication** with relevant parties in case of critical vulnerabilities or security incidents is also important.

Finally, **using legitimate tools and techniques** is a must. Only authorized tools should be used, and the tests should be designed to avoid causing any damage to systems, data, or services. This careful approach ensures that the testing is both ethical and effective.

## Resources

- [Microsoft Rules Of Engagement](https://www.microsoft.com/en-us/msrc/pentest-rules-of-engagement)
- [AWS Cloud Pentesting Needed](https://aws.amazon.com/security/penetration-testing/)
- [GCP Cloud Pentesting Needed](https://support.google.com/cloud/answer/6262505?hl=en)
- [List of Cloud Pentesting Resources](https://github.com/kh4sh3i/cloud-penetration-testing)
