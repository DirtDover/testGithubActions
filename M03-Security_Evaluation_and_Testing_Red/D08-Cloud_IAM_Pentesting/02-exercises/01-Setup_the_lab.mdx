# Setting Up Your IAM AWS Lab

Welcome, young link! In this step by step exercise, we’re going to cover **the instructions for setting up your very own IAM AWS lab**. 

This guide is tailored for beginners, so I’ll explain the key concepts and technical terms in a way that’s easy to follow. By the end of this session, you’ll have a functional AWS playground to practice your IAM skills.

<Note type="warning">

An AWS lab is a **sandbox environment**—a safe and isolated place where you can learn and experiment with AWS without risking your personal or production accounts. **But it use credits and you can spend money.**

**Do not forget to destroy the lab after you finish the exercise.**

</Note>

## Key Components of the Setup

Here are the primary tools and concepts you’ll encounter:

- **AWS Account**: A container for all your AWS resources.
- **IAM (Identity and Access Management)**: Controls who can access your AWS resources and what actions they can perform.
- **AWS CLI (Command Line Interface)**: A tool to interact with AWS using commands.
- **Terraform**: An infrastructure-as-code tool to define and manage your cloud infrastructure.

## Step-by-Step Guide

### 1. Create an AWS Account

You need access to AWS services to set up your lab.

1. Visit [AWS Free Tier](https://aws.amazon.com/free) and sign up for an account.
2. Use a separate email address for this lab to distinguish it from your personal or business accounts.
3. Set up **Multi-Factor Authentication (MFA)** for additional security (we are in cybersecurity school, we need to be secure, right?).

### 2. Create a Non-Root User With Admin Access

The AWS root account has the highest privileges and should not be used for daily tasks.

1. Go to the **AWS IAM console**.
2. Create a new user:
   - Username: `lab-admin`
   - Access Type: **Programmatic access** (for CLI and SDKs).
3. Assign the user to the **AdministratorAccess** policy.
4. Generate an **Access Key ID** and **Secret Access Key** (this allows the new user to connect from the AWS CLI).
5. Save these credentials securely.

**Pro Tip**: Root users cannot assume roles, so you’ll need this admin user to deploy configurations later.

### 3. Install AWS CLI

The **AWS CLI** lets you manage AWS resources directly from your terminal.

1. Download and install the [AWS CLI](https://aws.amazon.com/cli/).
2. Configure it with your new non-root admin user:

```bash
aws configure
```

Enter:
   - Access Key ID
   - Secret Access Key
   - Default Region (e.g., `us-east-1`)
   - Output format (e.g., `json`)

3. Test the configuration:

```bash
aws sts get-caller-identity
```

This should return the user’s ARN (Amazon Resource Name), verifying that it’s correctly set up.

### 4. Install Terraform

Terraform will allow you to automate the deployment of resources in your AWS lab.

1. Download [Terraform](https://www.terraform.io/downloads.html) for your system.
2. Add the Terraform binary to your system's PATH.
   - On Linux/MacOS: Add the binary location to your `.bashrc` or `.zshrc`.
   - On Windows: Add it to the Environment Variables.
3. Verify the installation:

```bash
terraform version
```

### 5. Clone the IAM Vulnerable Repository

We’ll use an open-source tool called **IAM Vulnerable** to simulate AWS IAM misconfigurations for learning.

1. Clone the repository from GitHub:

```bash
git clone https://github.com/BishopFox/iam-vulnerable
cd iam-vulnerable
```

2. Initialize Terraform:

```bash
terraform init
```

### 6. Deploy the Environment

IAM Vulnerable deploys multiple IAM users, roles, and policies to simulate privilege escalation paths.

1. Deploy the free resources:

```bash
terraform apply
```

Terraform will show you a plan of actions. Type `yes` to accept and deploy the configuration.

2. Once deployed, Terraform will create around 255 IAM resources simulating various misconfigurations.

**Pro Tip**: If you need additional resources (like EC2 instances or Lambda), uncomment the relevant modules in the `main.tf` file and run `terraform apply` again.

### 7. Clean Up and Tear Down Resources

To remove your lab environment and avoid incurring costs:

1. Destroy the resources:

```bash
terraform destroy
```

2. Confirm by typing `yes`.

### Potential Costs When Using IAM Vulnerable

AWS offers a **Free Tier** for many of its services, which allows for limited usage without incurring charges. For IAM resources like users, roles, and policies (which are the primary components of IAM Vulnerable), there are no costs associated as they fall entirely under the AWS Free Tier.

**Services Covered Under the Free Tier:**

- **IAM Entities (Users, Roles, Policies):** Unlimited.
- **EC2 Instances:** Up to 750 hours per month of a t2.micro or t4g.micro instance for 12 months.
- **Lambda:** 1,000,000 free requests and 400,000 GB-seconds of compute time per month.

While the default setup of IAM Vulnerable (the free-resources module) incurs no additional costs beyond the Free Tier, **non-free resources** (like EC2 instances or Lambda functions) will generate charges if you choose to deploy them.

1. **EC2 Instances:**
   - Costs kick in once you exceed the Free Tier limits or deploy larger instance types.
   - Ensure you tear down any EC2 instances when not in use to avoid unnecessary expenses.

2. **Lambda Functions:**
   - Beyond the Free Tier limits, costs can add up based on function executions and compute time.

3. **Other AWS Services:**
   - Any additional AWS services you use (e.g., S3, RDS) may incur costs based on usage.

## Ready?

This AWS lab setup provides you with a safe and cost-effective way to learn. Remember:

- Always use a **separate AWS account** for experimenting.
- **Tear down your environment** when not in use.
